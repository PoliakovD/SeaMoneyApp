<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"

             xmlns:local="clr-namespace:SeaMoneyApp.Localization"
             xmlns:c="clr-namespace:SeaMoneyApp.Converters"
             xmlns:viewModels="clr-namespace:SeaMoneyApp.ViewModels"
             xmlns:m="using:SeaMoneyApp.DataAccess.Models"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             xmlns:seaMoneyApp="clr-namespace:SeaMoneyApp"

             x:DataType="viewModels:IncomesViewModel"
             x:Class="SeaMoneyApp.Views.IncomesView">
    <UserControl.Resources>
        <c:DateTimeToDateTimeOffsetConverter x:Key="DateTimeToDateTimeOffsetConverter" />
        <DataTemplate x:Key="TemplateWageLog"
                      DataType="{x:Type TypeName=m:WageLog}">
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Left">
                <TextBlock
                    Text="{Binding Date,
                UpdateSourceTrigger=PropertyChanged, Mode=OneWay, StringFormat=dd.MM.yyyy}"
                    Margin="10,5,10,5"
                    Width="80" />
                <TextBlock Text="{Binding AmountInRub,
                UpdateSourceTrigger=PropertyChanged, 
                Mode=OneWay,
                StringFormat={}{0} руб.}"
                           Margin="10,5,10,5"
                           Width="120" />
                <TextBlock Text="{Binding AmountInDollars,UpdateSourceTrigger=PropertyChanged, Mode=OneWay,
                 StringFormat={}{0:F2} $}"
                           Margin="10,5,10,5"
                           Width="90" />
                <TextBlock
                    Text="{Binding ChangeRubToDollar.Value,
                        UpdateSourceTrigger=PropertyChanged,
                        Mode=OneWay,
                        StringFormat={}{0:F2} руб/$}"
                    Margin="10,5,10,5"
                    Width="100" />
                <TextBlock Margin="10,5,10,5">
                    <TextBlock.Text>
                        <MultiBinding StringFormat=" {0} / {1} / {2} - {3}">
                            <Binding Path="Position.Name" />
                            <Binding Path="Contract.VesselName" />
                            <Binding Path="Contract.BeginDate" StringFormat="d" />
                            <Binding Path="Contract.EndDate" StringFormat="d" />
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
            </StackPanel>
        </DataTemplate>
        <DataTemplate x:Key="TemplateContract"
                      DataType="{x:Type TypeName=m:Contract}">
            <TextBlock>
                <TextBlock.Text>
                    <MultiBinding StringFormat=" {0}: {1} - {2}">
                        <Binding Path="VesselName" />
                        <Binding Path="BeginDate" StringFormat="dd.MM.yyyy" />
                        <Binding Path="EndDate" StringFormat="dd.MM.yyyy" />
                    </MultiBinding>
                </TextBlock.Text>
            </TextBlock>
        </DataTemplate>
    </UserControl.Resources>


    <DockPanel LastChildFill="True">
        <StackPanel DockPanel.Dock="Top">
            <TextBlock Text="{Binding CurrentState}"
                       Foreground="MediumBlue"
                       FontWeight="Bold"
                       FontSize="20"
                       Margin="20,20,0,0" />
            <StackPanel 
                        Orientation="Horizontal">

                <StackPanel Orientation="Vertical" MinWidth="250">
                    <TextBlock Text="Дата"  HorizontalAlignment="Center" />
                    <DatePicker
                        SelectedDate="{Binding SelectedWageLog.Date, 
                    Converter={StaticResource DateTimeToDateTimeOffsetConverter},
                    UpdateSourceTrigger=PropertyChanged,
                    Mode=TwoWay}"
                        IsEnabled="{Binding IsEditing}"
                        Margin="10,0,10,0"  
                        VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Orientation="Vertical" MinWidth="120">
                    <TextBlock Text="Сумма поступления"  HorizontalAlignment="Center"  />
                    <TextBox Text="{Binding SelectedWageLog.AmountInRub}"
                             IsEnabled="{Binding IsEditing}"
                             Margin="10,0,10,0" 
                             VerticalAlignment="Center"/>
                </StackPanel>
                
                <StackPanel Orientation="Vertical" 
                            MinWidth="300">
                    <TextBlock Text="Контракт"  HorizontalAlignment="Center" />
                    <ComboBox ItemsSource="{Binding AvailableContracts}"
                              SelectedItem="{Binding SelectedContract}"
                              ItemTemplate="{StaticResource TemplateContract}"
                              IsEnabled="{Binding IsEditing}" 
                              VerticalAlignment="Center"
                              MinWidth="300"
                              Margin="10,0,10,0" />
                </StackPanel>
            </StackPanel>
            <TextBlock Text="{Binding ErrorMessage}"
                       Foreground="Coral"
                       FontWeight="Bold"
                       FontSize="15" />
            <StackPanel Orientation="Horizontal">
                <Button Content="{x:Static local:Localization.DeleteText}"
                        Command="{Binding DeleteWageLogCommand}" Classes="btn-danger" />
                <Button Content="{x:Static local:Localization.AddText}"
                        Command="{Binding AddWageLogCommand}" Classes="btn-primary" />
                <Button Content="{x:Static local:Localization.EditText}"
                        Command="{Binding EditWageLogCommand}" Classes="btn-primary" />
                <Button Content="{x:Static local:Localization.SaveText}"
                        Command="{Binding SaveWageLogCommand}" Classes="btn-success" />
                <Button Content="{x:Static local:Localization.CancelText}"
                        Command="{Binding CancelEditWageLogCommand}" Classes="btn-secondary" />
            </StackPanel>
        </StackPanel>
        
        <Grid ColumnDefinitions="100,140,110,120,*"
              RowDefinitions="30,*">
            <TextBlock Grid.Column="0" Grid.Row="0" HorizontalAlignment="Center" Text="Дата"/>
            <TextBlock  Grid.Column="1" Grid.Row="0" HorizontalAlignment="Center" Text="Сумма(руб)"/>
            <TextBlock  Grid.Column="2" Grid.Row="0" HorizontalAlignment="Center" Text="Сумма($)"/>
            <TextBlock  Grid.Column="3" Grid.Row="0" HorizontalAlignment="Center" Text="Курс"/>
            <TextBlock  Grid.Column="4" Grid.Row="0" 
                        Margin="50,0,0,0" HorizontalAlignment="Left" Text="Описание"/>
            <ListBox  Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="5"
                      ItemsSource="{Binding WageLogs}"
                      SelectedItem="{Binding SelectedWageLog, Mode=OneWayToSource}"
                      ItemTemplate="{StaticResource TemplateWageLog}" />
        </Grid>
       
    </DockPanel>
</UserControl>